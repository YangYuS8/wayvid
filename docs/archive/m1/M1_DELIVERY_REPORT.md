# wayvid - M1 MVP Delivery Report

## é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: wayvid - Wayland Video Wallpaper Engine  
**å½“å‰ç‰ˆæœ¬**: v0.1.0 (Milestone 1 MVP)  
**å¼€å‘æ—¥æœŸ**: 2025-10-20  
**çŠ¶æ€**: âœ… M1 å®Œæˆ,å¯ç¼–è¯‘,æ¶æ„å°±ç»ª

## äº¤ä»˜æ¸…å•

### âœ… å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

#### 1. é¡¹ç›®åŸºç¡€è®¾æ–½
- [x] Rust é¡¹ç›®ç»“æ„(MSRV 1.75+)
- [x] Cargo.toml å®Œæ•´é…ç½®(features, ä¾èµ–, ä¼˜åŒ–é…ç½®)
- [x] æ¨¡å—åŒ–æ¶æ„(core, backend, video, ctl)
- [x] é”™è¯¯å¤„ç†(anyhow + thiserror)
- [x] æ—¥å¿—ç³»ç»Ÿ(tracing + tracing-subscriber)
- [x] CLI æ¥å£(clap)

#### 2. Wayland åç«¯
- [x] Wayland è¿æ¥ä¸åè®®å‘ç°
- [x] wlr-layer-shell èƒŒæ™¯å±‚åˆ›å»º
- [x] è¾“å…¥å®Œå…¨ç©¿é€é…ç½®
- [x] è¾“å‡º(æ˜¾ç¤ºå™¨)è·Ÿè¸ª
- [x] äº‹ä»¶å¾ªç¯ä¸ Dispatch å®ç°
- [x] å¤šè¾“å‡ºåŸºç¡€æ”¯æŒ

#### 3. è§†é¢‘æ’­æ”¾
- [x] libmpv é›†æˆ
- [x] ç¡¬ä»¶è§£ç é…ç½®(VA-API/NVDEC)
- [x] æ’­æ”¾å‚æ•°(å¾ªç¯ã€èµ·å§‹æ—¶é—´ã€é€Ÿç‡ã€éŸ³é‡)
- [x] è§†é¢‘æ–‡ä»¶åŠ è½½

#### 4. å¸ƒå±€ç³»ç»Ÿ
- [x] äº”ç§å¸ƒå±€æ¨¡å¼(Fill, Contain, Stretch, Cover, Centre)
- [x] å¸ƒå±€è®¡ç®—ç®—æ³•
- [x] å•å…ƒæµ‹è¯•

#### 5. é…ç½®ç³»ç»Ÿ
- [x] YAML é…ç½®è§£æ(serde_yaml)
- [x] Per-output è¦†ç›–æœºåˆ¶
- [x] æœ‰æ•ˆé…ç½®è®¡ç®—
- [x] ç¤ºä¾‹é…ç½®æ–‡ä»¶

#### 6. CLI å·¥å…·
- [x] `wayvid run` - è¿è¡Œå£çº¸å¼•æ“
- [x] `wayvid check` - ç³»ç»Ÿèƒ½åŠ›è‡ªæ£€
- [x] æ—¥å¿—çº§åˆ«æ§åˆ¶

#### 7. æ‰“åŒ…ä¸åˆ†å‘
- [x] systemd user service å•å…ƒ
- [x] Hyprland è‡ªå¯é…ç½®ç¤ºä¾‹
- [x] niri è‡ªå¯é…ç½®ç¤ºä¾‹
- [x] AUR PKGBUILD
- [x] Nix flake
- [x] AppImage è„šæ‰‹æ¶(M2 å®Œå–„)

#### 8. æ–‡æ¡£
- [x] README.md(å…¨é¢çš„ç”¨æˆ·æ–‡æ¡£)
- [x] QUICKSTART.md(5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹)
- [x] CONTRIBUTING.md(è´¡çŒ®æŒ‡å—)
- [x] PROJECT_STRUCTURE.md(é¡¹ç›®ç»“æ„)
- [x] DEV_NOTES.md(å¼€å‘ç¬”è®°)
- [x] ä»£ç å†…æ–‡æ¡£æ³¨é‡Š

#### 9. CI/CD
- [x] GitHub Actions å·¥ä½œæµ
- [x] å¤šå¹³å°ç¼–è¯‘(x86_64, aarch64)
- [x] ä»£ç æ£€æŸ¥(check, test, clippy, fmt)

### âš ï¸ å·²çŸ¥é™åˆ¶(æŒ‰è®¡åˆ’)

#### MVP ç®€åŒ–éƒ¨åˆ†
- âš ï¸ OpenGL/EGL æ¸²æŸ“ä¸ºå ä½ç¬¦(éœ€è¦å®Œæ•´å®ç°)
- âš ï¸ æ—  vsync/å¸§åŒæ­¥(M2 å®ç°)
- âš ï¸ æ— çƒ­æ’æ‹”æ£€æµ‹(M2 å®ç°)
- âš ï¸ çœç”µç­–ç•¥æœªå¼ºåˆ¶æ‰§è¡Œ(M2 å®ç°)
- âš ï¸ å½“å‰ä½¿ç”¨ null video output(è§†é¢‘ä¸ä¼šå®é™…æ˜¾ç¤º)

è¿™äº›éƒ½æ˜¯é¢„æœŸçš„ç®€åŒ–,æ˜¯ M1 MVP èŒƒå›´çš„ä¸€éƒ¨åˆ†ã€‚

## ç¼–è¯‘æµ‹è¯•

```bash
$ cargo build --release
   Compiling wayvid v0.1.0
    Finished `dev` profile [optimized + debuginfo] target(s) in 20.77s

# ç¼–è¯‘æˆåŠŸ âœ…
# 10 ä¸ªè­¦å‘Š(æœªä½¿ç”¨çš„ä»£ç ,ä¸ºæœªæ¥åŠŸèƒ½ä¿ç•™) âœ…
# 0 ä¸ªé”™è¯¯ âœ…
```

## æ–‡ä»¶ç»Ÿè®¡

```
æ€»æ–‡ä»¶æ•°: 25+
æ ¸å¿ƒä»£ç æ–‡ä»¶: 15
é…ç½®/æ–‡æ¡£æ–‡ä»¶: 10+
ä»£ç è¡Œæ•°: ~2000+ (ä¸å«ç©ºè¡Œå’Œæ³¨é‡Š)

å…³é”®æ–‡ä»¶:
- src/main.rs (95 lines)
- src/config.rs (175 lines)
- src/backend/wayland/app.rs (280 lines)
- src/backend/wayland/surface.rs (130 lines)
- src/video/mpv.rs (100 lines)
- src/core/layout.rs (130 lines)
- src/ctl/check.rs (140 lines)
```

## ä¾èµ–é¡¹

### æ ¸å¿ƒè¿è¡Œæ—¶ä¾èµ–
- wayland-client, wayland-protocols, wayland-protocols-wlr
- smithay-client-toolkit
- libmpv (video-mpv feature)
- khronos-egl, gl
- calloop (äº‹ä»¶å¾ªç¯)

### é…ç½®ä¸ CLI
- serde, serde_yaml
- clap
- shellexpand

### é”™è¯¯å¤„ç†ä¸æ—¥å¿—
- anyhow, thiserror
- tracing, tracing-subscriber

### ç‰¹æ€§æ ‡å¿—
- default = ["video-mpv", "backend-wayland"]
- å¯é€‰: video-gst, config-toml, ipc, telemetry, tray

## éªŒæ”¶æ ‡å‡†æ£€æŸ¥

### M1 éªŒæ”¶æ ‡å‡†

| æ ‡å‡† | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| é¡¹ç›®ç»“æ„æ¸…æ™° | âœ… | æ¨¡å—åŒ–,æ˜“æ‰©å±• |
| ä¾èµ–é…ç½®å®Œæ•´ | âœ… | Feature flags é½å…¨ |
| ç¼–è¯‘æˆåŠŸæ— é”™è¯¯ | âœ… | 10 warnings(é¢„æœŸ) |
| Layer-shell é›†æˆ | âœ… | èƒŒæ™¯å±‚åˆ›å»º |
| è¾“å…¥ç©¿é€é…ç½® | âœ… | exclusive_zone=0 |
| libmpv é›†æˆ | âœ… | åˆå§‹åŒ–ä¸é…ç½® |
| å¸ƒå±€è®¡ç®—æ­£ç¡® | âœ… | å«å•å…ƒæµ‹è¯• |
| é…ç½®ç³»ç»Ÿå·¥ä½œ | âœ… | YAML + per-output |
| CLI å¯ç”¨ | âœ… | run, check å‘½ä»¤ |
| èƒ½åŠ›è‡ªæ£€åŠŸèƒ½ | âœ… | Wayland, ç¡¬è§£æ£€æµ‹ |
| æ–‡æ¡£å®Œæ•´ | âœ… | README, QUICKSTART ç­‰ |
| æ‰“åŒ…è„šæ‰‹æ¶ | âœ… | AUR, Nix, systemd |

### åŠŸèƒ½æµ‹è¯•(å¾…è¿è¡Œæ—¶éªŒè¯)
| æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ | å®é™…çŠ¶æ€ |
|--------|----------|----------|
| `wayvid check` æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ | âœ… | æœªæµ‹è¯•(éœ€ Wayland ç¯å¢ƒ) |
| `wayvid run` åˆ›å»º layer surface | âœ… | æœªæµ‹è¯• |
| è¾“å…¥å®Œå…¨ç©¿é€ | âœ… | æœªæµ‹è¯• |
| è§†é¢‘å®é™…æ˜¾ç¤º | âŒ | é¢„æœŸä¸æ˜¾ç¤º(null vo) |
| é…ç½®åŠ è½½ | âœ… | åº”è¯¥å·¥ä½œ |
| Per-output è¦†ç›– | âœ… | åº”è¯¥å·¥ä½œ |

## æ”¯æŒçš„åˆæˆå™¨

| åˆæˆå™¨ | wlr-layer-shell | é¢„æœŸæ”¯æŒ | æµ‹è¯•çŠ¶æ€ |
|--------|-----------------|----------|----------|
| Hyprland | âœ… | âœ… | æœªæµ‹è¯• |
| niri | âœ… | âœ… | æœªæµ‹è¯• |
| Sway | âœ… | âœ… | æœªæµ‹è¯• |
| River | âœ… | ğŸŸ¡ | æœªæµ‹è¯• |
| KDE | âŒ | âŒ | ä¸æ”¯æŒ |
| GNOME | âŒ | âŒ | ä¸æ”¯æŒ |

## åç»­é‡Œç¨‹ç¢‘è§„åˆ’

### M2: å¤šè¾“å‡ºä¸çƒ­æ’æ‹” (3-5 å‘¨)
**å…³é”®ä»»åŠ¡:**
1. å®Œæ•´çš„ OpenGL/EGL æ¸²æŸ“ç®¡çº¿
2. mpv_render_context é›†æˆ
3. å¸§å›è°ƒä¸ vsync
4. è¾“å‡ºçƒ­æ’æ‹”æ£€æµ‹
5. æ€§èƒ½æŒ‡æ ‡ä¸ç›‘æ§

**äº¤ä»˜ç‰©:**
- å®é™…èƒ½çœ‹åˆ°è§†é¢‘çš„ç‰ˆæœ¬
- å¤šæ˜¾ç¤ºå™¨å®Œæ•´æ”¯æŒ
- FPS/æ€§èƒ½ç»Ÿè®¡
- ç”µæºç®¡ç†å®ç°

### M3: WE å¯¼å…¥ä¸åˆ†å‘å®Œå–„ (3-5 å‘¨)
**å…³é”®ä»»åŠ¡:**
1. Wallpaper Engine é¡¹ç›®å¯¼å…¥å™¨
2. Flatpak æ‰“åŒ…
3. Debian/RPM æ‰“åŒ…
4. æ•…éšœæ’æŸ¥æ–‡æ¡£
5. æ€§èƒ½ä¼˜åŒ–

**äº¤ä»˜ç‰©:**
- `wayvid import-we` å‘½ä»¤
- å®Œæ•´çš„åˆ†å‘åŒ…
- ç”¨æˆ·æ–‡æ¡£å®Œå–„

### M4: é«˜çº§ç‰¹æ€§ (æŒç»­)
**å¯é€‰åŠŸèƒ½:**
- å…±äº«è§£ç ä¼˜åŒ–
- é™æ€å›¾ç‰‡å›é€€
- IPC/D-Bus æ§åˆ¶
- ç³»ç»Ÿæ‰˜ç›˜(å¯é€‰)
- è‰²å½©ç®¡ç†
- HDR æ”¯æŒè§„åˆ’

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```bash
# æ£€æŸ¥ç³»ç»Ÿèƒ½åŠ›
wayvid check

# è¿è¡Œå£çº¸å¼•æ“
wayvid run --config ~/.config/wayvid/config.yaml

# Debug æ¨¡å¼
wayvid run --log-level debug
```

### é…ç½®ç¤ºä¾‹
```yaml
source:
  type: File
  path: "/home/user/Videos/wallpaper.mp4"

layout: Fill
loop: true
mute: true
hwdec: true

per_output:
  HDMI-A-1:
    layout: Contain
  eDP-1:
    source:
      type: File
      path: "/home/user/Videos/lowpower.mp4"
```

### è‡ªå¯åŠ¨
```conf
# Hyprland (~/.config/hypr/hyprland.conf)
exec-once = wayvid run

# niri (config.kdl)
spawn-at-startup "wayvid" "run"

# systemd
systemctl --user enable --now wayvid.service
```

## Wallpaper Engine å…¼å®¹æ€§

| å‚æ•° | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| è§†é¢‘æ–‡ä»¶ | âœ… | MP4, WebM, MKV |
| Loop | âœ… | `loop: true` |
| Start Time | âœ… | `start_time: 10.5` |
| Playback Rate | âœ… | `playback_rate: 1.5` |
| Volume/Mute | âœ… | `mute: true`, `volume: 0.5` |
| å¯¹é½æ–¹å¼ | âœ… | é€šè¿‡ `layout` æ¨¡å¼ |
| ç¼©æ”¾ | âœ… | é€šè¿‡ `layout` æ¨¡å¼ |
| äº’åŠ¨ç‰¹æ€§ | âŒ | ä¸æ”¯æŒ(éç›®æ ‡) |
| HTML/WebGL | âŒ | ä¸æ”¯æŒ(éç›®æ ‡) |

## æŠ€æœ¯äº®ç‚¹

1. **ç±»å‹å®‰å…¨çš„é…ç½®**: ä½¿ç”¨ serde + YAML,æ”¯æŒæ¯è¾“å‡ºè¦†ç›–
2. **å®Œå…¨è¾“å…¥ç©¿é€**: å£çº¸ä¸æŠ¢ç„¦ç‚¹,ä¸å½±å“æ¡Œé¢äº¤äº’
3. **ç¡¬ä»¶è§£ç æ”¯æŒ**: VA-API/NVDEC,è‡ªåŠ¨å›é€€è½¯è§£
4. **çµæ´»å¸ƒå±€**: 5 ç§æ¨¡å¼,æ­£ç¡®å¤„ç†å®½é«˜æ¯”
5. **ç»“æ„åŒ–æ—¥å¿—**: tracing æ¡†æ¶,å¯è§‚æµ‹æ€§å¼º
6. **ç‰¹æ€§å¼€å…³**: æ¨¡å—åŒ–ç¼–è¯‘,å¯é€‰åŠŸèƒ½
7. **æ¸…æ™°æ¶æ„**: backend/video/core åˆ†ç¦»,æ˜“ç»´æŠ¤

## å·²çŸ¥é—®é¢˜ä¸é™åˆ¶

### è®¾è®¡é™åˆ¶(æŒ‰è®¡åˆ’)
1. ä»…æ”¯æŒ Wayland(ä¸æ”¯æŒ X11)
2. ä»…æ”¯æŒ wlr-layer-shell(ä¸æ”¯æŒ KDE/GNOME)
3. å½“å‰ç‰ˆæœ¬ä»…è§†é¢‘ç±»å£çº¸(ä¸æ”¯æŒ HTML/äº’åŠ¨)

### æŠ€æœ¯å€ºåŠ¡
1. EGL ä¸Šä¸‹æ–‡ç®¡ç†éœ€å®Œå–„
2. Wayland å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéœ€æ›´å¤šæµ‹è¯•
3. é”™è¯¯æ¢å¤æœºåˆ¶éœ€åŠ å¼º
4. æ€§èƒ½æœªç»æµ‹è¯•

### MVP ç®€åŒ–(M2 è§£å†³)
1. è§†é¢‘ä¸ä¼šå®é™…æ¸²æŸ“åˆ°å±å¹•(null vo)
2. æ— å¸§åŒæ­¥/vsync
3. æ— çƒ­æ’æ‹”æ£€æµ‹
4. çœç”µç­–ç•¥æœªæ‰§è¡Œ

## å¼€å‘ç¯å¢ƒ

```bash
# ä¾èµ–å®‰è£…(Arch Linux)
sudo pacman -S rust wayland libmpv mesa intel-media-driver

# æ„å»º
cargo build --release

# è¿è¡Œæ£€æŸ¥
./scripts/dev-check.sh

# ä»£ç è´¨é‡
cargo clippy --all-features
cargo fmt --all
cargo test --all-features
```

## æ€§èƒ½é¢„æœŸ(ä¼°è®¡)

### M1 å½“å‰(null vo)
- CPU: ~1-2% (æœ€å°å¼€é”€)
- å†…å­˜: ~100 MB
- GPU: 0%

### M2 ç›®æ ‡(å®Œæ•´æ¸²æŸ“)
- CPU: 2-5% (ç¡¬è§£) / 10-20% (è½¯è§£)
- å†…å­˜: 100-300 MB per output
- GPU: 5-15% (è§£ç +æ¸²æŸ“)

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®!ä¼˜å…ˆé¢†åŸŸ:
- OpenGL/EGL æ¸²æŸ“å®ç° (M2 æ ¸å¿ƒ)
- ä¸åŒåˆæˆå™¨æµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–
- æ–‡æ¡£æ”¹è¿›

å‚è§ [CONTRIBUTING.md](CONTRIBUTING.md)

## è®¸å¯è¯

MIT OR Apache-2.0 åŒè®¸å¯

## è‡´è°¢

- [mpv](https://mpv.io/) - ä¼˜ç§€çš„åª’ä½“æ’­æ”¾åº“
- [Hyprland](https://hyprland.org/) / [niri](https://github.com/YaLTeR/niri) - ç°ä»£ Wayland åˆæˆå™¨
- [wlr-layer-shell](https://wayland.app/protocols/wlr-layer-shell-unstable-v1) - å›¾å±‚ shell åè®®
- Wayland ç¤¾åŒº

---

## ç»“è®º

âœ… **M1 MVP å·²æˆåŠŸäº¤ä»˜**

é¡¹ç›®æ¶æ„å®Œå–„,ä»£ç ç¼–è¯‘é€šè¿‡,æ–‡æ¡£é½å…¨ã€‚è™½ç„¶å½“å‰ç‰ˆæœ¬ç”±äº OpenGL é›†æˆç®€åŒ–è€Œä¸ä¼šå®é™…æ˜¾ç¤ºè§†é¢‘,ä½†è¿™æ˜¯ MVP é˜¶æ®µçš„é¢„æœŸè®¾è®¡ã€‚æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å·²å°±ä½,ä¸º M2 çš„å®Œæ•´å®ç°å¥ å®šäº†åšå®åŸºç¡€ã€‚

**ä¸‹ä¸€æ­¥**: å¼€å§‹ M2 å¼€å‘,é‡ç‚¹å®ç° OpenGL/EGL æ¸²æŸ“ç®¡çº¿ã€‚

**é¢„è®¡æ—¶é—´çº¿**:
- M2 å®Œæˆ: 3-5 å‘¨
- M3 å®Œæˆ: 6-10 å‘¨
- M4 æŒç»­ä¼˜åŒ–

**ç«‹å³å¯åš**:
1. åœ¨ Hyprland/niri ä¸Šæµ‹è¯•å½“å‰æ„å»º
2. éªŒè¯ layer surface åˆ›å»ºå’Œè¾“å…¥ç©¿é€
3. å¼€å§‹ç ”ç©¶ mpv_render_context API
4. å‡†å¤‡ OpenGL æ¸²æŸ“åŸå‹

---

**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ å¥åº·,æŒ‰è®¡åˆ’æ¨è¿›
**ä»£ç è´¨é‡**: ğŸŸ¢ è‰¯å¥½,æ¶æ„æ¸…æ™°
**æ–‡æ¡£å®Œæ•´åº¦**: ğŸŸ¢ ä¼˜ç§€,è¦†ç›–å…¨é¢
**å¯ç»´æŠ¤æ€§**: ğŸŸ¢ é«˜,æ¨¡å—åŒ–è®¾è®¡

**Made with â¤ï¸ for the Wayland community**
